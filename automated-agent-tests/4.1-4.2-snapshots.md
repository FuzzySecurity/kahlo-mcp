# Phase 4.1-4.2: Snapshot Collection and Analysis

## Target Information
- **Target ID**: `tgt_7a20e4fc-12f7-42c2-8e4d-4569053eeff6`
- **Target Package**: LINE (jp.naver.line.android)
- **Timestamp**: 2026-01-21

---

## 4.1: Process Info Snapshot

### Raw Snapshot Data
```json
{
  "target_id": "tgt_7a20e4fc-12f7-42c2-8e4d-4569053eeff6",
  "kind": "process.info",
  "snapshot": {
    "pid": 13791,
    "arch": "arm64",
    "platform": "linux",
    "pointer_size": 8,
    "page_size": 4096
  }
}
```

### Process Info Validation
- [x] **PID matches target**: `13791`
- [x] **Architecture identified**: `arm64` (ARM 64-bit)
- [x] **Runtime info present**: Linux platform, 8-byte pointers, 4096-byte pages

### Key Findings
- **Architecture**: ARM64 (AArch64)
- **Pointer Size**: 8 bytes (64-bit address space)
- **Page Size**: 4096 bytes (standard Linux page size)
- **Platform**: Linux (Android)

This confirms we are analyzing a native ARM64 Android application with full 64-bit addressing capabilities.

---

## 4.2: Native Modules Snapshot

### Summary Statistics
- **Total Native Modules Loaded**: 353 modules
- **System Libraries**: ~300+ modules
- **LINE App Libraries**: 42 custom libraries
- **Truncated**: No (complete snapshot)

### System Critical Libraries (Security-Relevant)

#### Cryptographic Libraries
1. **libcrypto.so** (System)
   - Base: `0x768cc07000`
   - Size: 1,421,312 bytes (~1.35 MB)
   - Path: `/system/lib64/libcrypto.so`
   - **Note**: Main OpenSSL crypto implementation

2. **libcrypto.so** (Conscrypt - Google's SSL provider)
   - Base: `0x73b684e000`
   - Size: 1,642,496 bytes (~1.56 MB)
   - Path: `/apex/com.android.conscrypt/lib64/libcrypto.so`
   - **Note**: BoringSSL-based implementation

3. **libssl.so** (Conscrypt)
   - Base: `0x73b3cb3000`
   - Size: 593,920 bytes (~580 KB)
   - Path: `/apex/com.android.conscrypt/lib64/libssl.so`

4. **libjavacrypto.so** (Conscrypt JNI bridge)
   - Base: `0x73c1b02000`
   - Size: 253,952 bytes (~248 KB)
   - Path: `/apex/com.android.conscrypt/lib64/libjavacrypto.so`

5. **stable_cronet_libcrypto.so** (Chromium network stack)
   - Base: `0x736766c000`
   - Size: 1,593,344 bytes (~1.52 MB)
   - Path: `/apex/com.android.tethering/lib64/stable_cronet_libcrypto.so`

6. **stable_cronet_libssl.so** (Chromium SSL)
   - Base: `0x7368f04000`
   - Size: 479,232 bytes (~468 KB)
   - Path: `/apex/com.android.tethering/lib64/stable_cronet_libssl.so`

7. **stable_cronet_libpki.so** (Chromium PKI)
   - Base: `0x7368e84000`
   - Size: 466,944 bytes (~456 KB)
   - Path: `/apex/com.android.tethering/lib64/stable_cronet_libpki.so`

#### Core System Libraries
- **libc.so**: `0x7693c90000` (5,464,064 bytes) - Standard C library
- **libart.so**: `0x73f4800000` (12,718,080 bytes ~12.1 MB) - Android Runtime
- **libbinder.so**: `0x7695536000` (794,624 bytes) - IPC mechanism
- **libandroid_runtime.so**: `0x768ef59000` (2,408,448 bytes) - Android framework runtime

#### Native Graphics/Rendering
- **libGLES_mali.so**: `0x73a904e000` (43,298,816 bytes ~41.3 MB) - Mali GPU driver
- **libvulkan.so**: `0x7686043000` (200,704 bytes)
- **libEGL.so**: `0x7695e40000` (262,144 bytes)
- **libhwui.so**: `0x7690200000` (10,702,848 bytes ~10.2 MB) - Hardware UI renderer

#### WebView / Chromium
- **libmonochrome_64.so**: `0x7368f99000` (187,584,512 bytes ~178.9 MB)
  - Path: `/data/app/~~6Izq_OKaXPx1bqVf2QxzPw==/com.google.android.trichromelibrary_755905933-EW9MXTB7Vhj-DMti7U7JlQ==/base.apk!/lib/arm64-v8a/libmonochrome_64.so`
  - **Note**: Largest library - Combined Chrome browser/WebView implementation

---

## LINE Application Native Libraries (42 Total)

### Security-Critical Libraries

#### Custom Crypto Implementation (LINE-specific)
1. **libcrypto3line.so**
   - Base: `0x726ea61000`
   - Size: 3,571,712 bytes (~3.4 MB)
   - Path: `/data/app/.../jp.naver.line.android.../split_config.arm64_v8a.apk!/lib/arm64-v8a/libcrypto3line.so`
   - **Priority**: CRITICAL - Custom OpenSSL fork or modified crypto library

2. **libssl3line.so**
   - Base: `0x726604c000`
   - Size: 634,880 bytes (~620 KB)
   - Path: `/data/app/.../split_config.arm64_v8a.apk!/lib/arm64-v8a/libssl3line.so`
   - **Priority**: CRITICAL - Custom SSL/TLS implementation

#### Database / Encryption
3. **libsqlcipher.so**
   - Base: `0x7244e20000`
   - Size: 5,234,688 bytes (~5 MB)
   - Path: `/data/app/.../split_config.arm64_v8a.apk!/lib/arm64-v8a/libsqlcipher.so`
   - **Priority**: HIGH - Encrypted SQLite database (likely contains message/chat DB encryption)

### AR/Graphics Engine (Elsa Framework)

#### Core Elsa Libraries
4. **libElsaEngine.so** - Main rendering engine
   - Base: `0x726d274000`, Size: 3,526,656 bytes (~3.36 MB)

5. **libElsaARMain.so** - Augmented Reality main module
   - Base: `0x7273f20000`, Size: 2,998,272 bytes (~2.86 MB)

6. **libElsaGraphics.so** - Graphics primitives
   - Base: `0x7268f12000`, Size: 425,984 bytes (~416 KB)

7. **libElsaBase.so** - Base utilities
   - Base: `0x7271709000`, Size: 933,888 bytes (~912 KB)

8. **libElsaImage.so** - Image processing
   - Base: `0x7266102000`, Size: 1,015,808 bytes (~992 KB)

9. **libElsaImageProcessing.so** - Advanced image processing
   - Base: `0x7264a0e000`, Size: 385,024 bytes (~376 KB)

#### Elsa Image Loaders
10. **libElsaImageLoader.so** - Generic loader (421,888 bytes)
11. **libElsaImageLoaderPng.so** - PNG support (114,688 bytes)
12. **libElsaImageLoaderJpg.so** - JPEG support (106,496 bytes)
13. **libElsaImageLoaderBasis.so** - Basis Universal texture format (425,984 bytes)
14. **libElsaImageLoaderAndroid.so** - Android-specific loaders (110,592 bytes)

#### Elsa Utilities
15. **libElsaKit.so** - UI kit components (552,960 bytes)
16. **libElsaPlatform.so** - Platform abstraction (86,016 bytes)
17. **libElsaDispatcher.so** - Event dispatcher (122,880 bytes)
18. **libElsaConfig.so** - Configuration (139,264 bytes)
19. **libElsaFile.so** - File handling (204,800 bytes)
20. **libElsaFilePackage.so** - Package management (155,648 bytes)
21. **libElsaWeb.so** - Web integration (155,648 bytes)
22. **libElsaDataVariant.so** - Data variant handling (131,072 bytes)
23. **libElsaDataSet.so** - Dataset utilities (212,992 bytes)
24. **libElsaDetection.so** - Object/face detection (450,560 bytes)
25. **libElsaProfiling.so** - Performance profiling (20,480 bytes)

#### Effects & Rendering
26. **libEffekseer.so** - Effects library
    - Base: `0x7268e42000`, Size: 765,952 bytes (~748 KB)

27. **libEffekseerRendererElsa.so** - Effects renderer for Elsa
    - Base: `0x726621f000`, Size: 1,507,328 bytes (~1.44 MB)

### Machine Learning / AI
28. **libtensorflowlite_c.so**
    - Base: `0x7263447000`
    - Size: 3,543,040 bytes (~3.38 MB)
    - **Priority**: MEDIUM - TensorFlow Lite inference engine

29. **libtensorflowlite_gpu_delegate.so**
    - Base: `0x7270ea3000`
    - Size: 8,441,856 bytes (~8.05 MB)
    - **Priority**: MEDIUM - GPU-accelerated TensorFlow (likely for AR/filters)

### UI Framework
30. **libyoga.so**
    - Base: `0x701291d000`
    - Size: 385,024 bytes (~376 KB)
    - **Note**: Flexbox layout engine (Facebook's Yoga, used by React Native)

### Scripting Engine
31. **libluacore.so**
    - Base: `0x7276664000`
    - Size: 278,528 bytes (~272 KB)
    - **Priority**: MEDIUM - Lua scripting engine (possibly for plugins/customization)

### Crash Reporting
32. **libsentry.so**
    - Base: `0x725ec1c000`
    - Size: 741,376 bytes (~724 KB)
    - **Priority**: MEDIUM - Sentry crash reporting

33. **libsentry-android.so**
    - Base: `0x7295fa8000`
    - Size: 32,768 bytes
    - **Priority**: MEDIUM - Android-specific Sentry integration

### Custom LINE Library
34. **libanna_jni.so**
    - Base: `0x726a66f000`
    - Size: 1,310,720 bytes (~1.25 MB)
    - **Priority**: HIGH - Unknown JNI bridge (name "anna" - possibly analytics or core functionality)

### Shared Runtime
35. **libc++_shared.so**
    - Base: `0x72768a2000`
    - Size: 1,372,160 bytes (~1.34 MB)
    - **Note**: C++ standard library (shared by multiple LINE native libraries)

### Data Storage
36. **libdatastore_shared_counter.so**
    - Base: `0x7365ce7000`
    - Size: 40,960 bytes
    - **Priority**: LOW - Shared counter/metrics storage

---

## Attack Surface Analysis

### High-Priority Security Targets

1. **Custom Cryptography** (CRITICAL)
   - `libcrypto3line.so` and `libssl3line.so` represent custom SSL/TLS implementation
   - Potential vulnerabilities: Custom crypto logic, certificate pinning bypass opportunities
   - **Investigation**: Hook SSL_read/SSL_write equivalents, certificate validation functions

2. **Encrypted Database** (HIGH)
   - `libsqlcipher.so` handles sensitive data encryption
   - Potential vulnerabilities: Key derivation weaknesses, plaintext key material in memory
   - **Investigation**: Hook SQLite encryption/decryption routines, key management functions

3. **WebView Integration** (HIGH)
   - `libmonochrome_64.so` (178 MB) is full Chromium implementation
   - Multiple WebView attack surfaces via `libElsaWeb.so`
   - Potential vulnerabilities: JavaScript bridge exploitation, WebView configuration weaknesses
   - **Investigation**: Hook WebView settings, JS interface registration

4. **JNI Bridge** (MEDIUM-HIGH)
   - `libanna_jni.so` (unknown functionality)
   - Potential vulnerabilities: Type confusion, memory corruption in JNI layer
   - **Investigation**: Reverse engineer exported JNI methods, hook JNI calls

5. **AR/ML Pipeline** (MEDIUM)
   - TensorFlow Lite + Elsa AR framework
   - Potential vulnerabilities: Model poisoning, malicious input via camera/AR
   - **Investigation**: Hook TensorFlow inference, AR input processing

### Notable Observations

#### Multiple Crypto Implementations
- **System**: Standard libcrypto.so (OpenSSL)
- **Conscrypt**: Google's BoringSSL-based provider
- **Chromium**: Cronet's embedded crypto
- **LINE Custom**: `libcrypto3line.so` and `libssl3line.so`

This suggests LINE may be implementing custom SSL/TLS logic, potentially for:
- Certificate pinning
- Protocol customization
- Traffic obfuscation
- Custom encryption schemes

#### Proprietary Elsa Framework
- 26 Elsa-related libraries totaling ~13 MB
- Full-featured AR/graphics engine
- Likely proprietary LINE technology
- Significant attack surface in image processing, file parsing, web integration

#### Lua Scripting Engine
- Presence of `libluacore.so` suggests dynamic scripting capabilities
- Potential for code injection if scripts can be externally influenced
- May be used for plugins, themes, or dynamic features

---

## Memory Layout Observations

### Address Space Distribution
- **Low addresses** (0x57d..., 0x70...): System executables, boot OAT files
- **Mid addresses** (0x72... - 0x73...): Application native libraries (LINE custom libs)
- **High addresses** (0x76...): System frameworks, ART runtime

### Largest Memory Consumers
1. libmonochrome_64.so: 187.6 MB (WebView/Chrome)
2. libGLES_mali.so: 41.3 MB (GPU driver)
3. libart.so: 12.1 MB (Android Runtime)
4. libhwui.so: 10.2 MB (Hardware UI)
5. libtensorflowlite_gpu_delegate.so: 8.05 MB (ML acceleration)

Total LINE native code: ~40 MB across 42 libraries

---

## Validation Results

### Process Info Snapshot
- [x] PID matches target: **13791**
- [x] Architecture identified: **arm64**
- [x] Runtime info present: **Complete**

### Native Modules Snapshot
- [x] System libraries present: **Yes** (libc.so, libm.so, libdl.so, etc.)
- [x] LINE app libraries present: **Yes** (42 custom libraries identified)
- [x] Base addresses and sizes included: **Complete for all 353 modules**

---

## Recommendations for Phase 5

1. **Crypto Analysis**
   - Decompile `libcrypto3line.so` and `libssl3line.so` for custom crypto inspection
   - Hook SSL/TLS functions to observe certificate validation logic
   - Search for certificate pinning implementations

2. **Database Security**
   - Hook `libsqlcipher.so` encryption functions
   - Identify key derivation routines and key material storage
   - Monitor database file access patterns

3. **JNI Attack Surface**
   - Reverse engineer `libanna_jni.so` to identify exposed native methods
   - Enumerate all JNI method registrations across LINE libraries
   - Test for type confusion and memory safety issues

4. **WebView Security**
   - Enumerate JavaScript bridge interfaces
   - Test for XSS, CSRF in WebView contexts
   - Verify WebView security configurations (allow file access, JS enabled, etc.)

5. **Lua Scripting**
   - Identify Lua script sources (embedded vs. network-loaded)
   - Test for script injection vulnerabilities
   - Hook Lua execution to observe runtime behavior

---

## Artifacts

### Full Module List
- 353 native modules catalogued
- Complete base addresses and sizes recorded
- No truncation (complete snapshot)

### Key Security Libraries Identified
- 7 cryptographic libraries (system + app)
- 42 LINE-specific native libraries
- 26 Elsa AR framework components
- 2 TensorFlow Lite ML libraries

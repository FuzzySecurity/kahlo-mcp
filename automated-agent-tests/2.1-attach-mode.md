# Phase 2.1 - Attach Mode (Running Process)

**Execution Timestamp**: 2026-01-21
**Device ID**: 2C161FDH200CY0
**Objective**: Attach Frida instrumentation to running LINE process

---

## Step 1: Verify LINE Process is Running

**Command**: `kahlo_processes_list(device_id="2C161FDH200CY0", scope="minimal")`

**Raw Output**:
```json
{
  "ok": true,
  "data": {
    "processes": [
      ... (172 processes total)
      {
        "pid": 12943,
        "name": "LINE",
        "parameters": {}
      },
      ...
    ]
  }
}
```

**Analysis**:
- LINE process successfully located
- Process ID: 12943
- Process name: "LINE" (not package identifier like "jp.naver.line.android")
- This is the running process display name required for attach mode

**Key Finding**: Frida process names in attach mode use display names, not Android package identifiers. The LINE app appears as "LINE" in the process list.

---

## Step 2: Attach to LINE Process

**Command**: `kahlo_targets_ensure(device_id="2C161FDH200CY0", package="LINE", mode="attach")`

**Raw Output**:
```json
{
  "ok": true,
  "data": {
    "target_id": "tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5"
  }
}
```

**Analysis**:
- Attachment operation succeeded
- Target ID assigned: `tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5`
- No gating specified (defaults to "none")
- No bootstrap job required for attach mode without spawn gating

**Status**: SUCCESS

---

## Step 3: Verify Target Status

**Command**: `kahlo_targets_status(target_id="tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5")`

**Raw Output**:
```json
{
  "ok": true,
  "data": {
    "target": {
      "target_id": "tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5",
      "device_id": "2C161FDH200CY0",
      "package": "LINE",
      "pid": 12943,
      "mode": "attach",
      "gating": "none",
      "state": "running",
      "agent_state": "ready"
    }
  }
}
```

**Analysis**:
- **Target ID**: tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5
- **PID**: 12943 (matches discovered process)
- **Mode**: attach (correct)
- **Gating**: none (expected for basic attach)
- **Lifecycle State**: running (process is active)
- **Agent State**: ready (orchestrator agent successfully injected and operational)

**Status**: FULLY OPERATIONAL

---

## Validation Checklist

- [x] **LINE process found in process list**
  - Located at PID 12943 with display name "LINE"

- [x] **Attachment succeeds**
  - kahlo_targets_ensure returned success with target_id

- [x] **target_id returned**
  - Value: `tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5`

- [x] **State shows "running"**
  - Confirmed in status response

- [x] **agent_state shows "ready"**
  - Orchestrator agent successfully injected and ready to accept jobs

---

## Key Information for Subsequent Phases

**Target ID**: `tgt_a5759ff2-55af-4795-9ac4-4eb6da36e4e5`

This target is now fully instrumented and ready to execute instrumentation jobs. The orchestrator agent is running in-process within LINE and can:
- Execute job scripts
- Install hooks via Interceptor API
- Enumerate Java classes and methods
- Capture snapshots of runtime state
- Emit telemetry events
- Generate artifacts

---

## Technical Notes

### Attach Mode Behavior
- Attaches to already-running process without suspending it
- No bootstrap job needed when gating="none"
- Cannot hook early initialization code (Application.onCreate, static initializers)
- Suitable for analyzing runtime behavior of already-initialized app

### Process Name Discovery
- Frida uses display names in attach mode (e.g., "LINE")
- Android package identifiers are required for spawn mode (e.g., "jp.naver.line.android")
- Always use `kahlo_processes_list` to confirm exact process name before attaching

### Agent State
- "ready" indicates orchestrator is operational
- Target can now accept job submissions via kahlo_jobs_start
- Jobs will execute in isolated script contexts with automatic cleanup on cancellation

---

## Status: COMPLETE

All validation criteria met. LINE process successfully instrumented in attach mode with orchestrator agent ready.
